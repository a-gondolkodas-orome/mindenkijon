<!DOCTYPE html>
<html>
<head>
    <title>Szennyeződés</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        h1 {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
            color: #000000;
            font-size: 24px;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            width: 95%;
            max-width: 650px;
            margin-bottom: 15px;
            background-color: #f0f8ff;
            border: 1px solid #1e3a8a;
            border-radius: 8px;
            padding: 10px;
        }
        #pools-canvas {
            width: 100%;
            max-width: 650px;
            height: auto;
            background-color: #f0f8ff;
        }
        #message {
            margin: 15px 0;
            font-weight: bold;
            color: #000000;
            padding: 8px 12px;
            min-height: 20px;
        }
        .input-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 95%;
            max-width: 350px;
            margin: 10px auto;
            background-color: #f0f8ff;
            border: 1px solid #1e3a8a;
            border-radius: 8px;
            padding: 15px;
        }
        label {
            margin-bottom: 10px;
            color: #000000;
            font-weight: 500;
            font-size: 15px;
        }
        #guess {
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #1e3a8a;
            border-radius: 4px;
            width: 50%;
            box-sizing: border-box;
            text-align: center;
            font-size: 15px;
        }
        #guess:focus {
            outline: none;
            border-color: #1e3a8a;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }
        button {
            background-color: #1e3a8a;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            box-sizing: border-box;
            font-weight: 500;
            width: 45%;
            max-width: 180px;
        }
        button:hover {
            background-color: #2d4eb8;
        }
        button:active {
            opacity: 0.9;
        }
        #question-count {
            margin-top: 15px;
            font-style: italic;
            color: #000000;
            padding: 5px 10px;
            display: inline-block;
        }
    </style>
</head>
<body>

    <h1>Szennyeződés</h1>

    <div class="game-container">
        <canvas id="pools-canvas"></canvas>
    </div>

    <p id="message"></p>
    
    <button id="reset-button" onclick="resetGame()">Játék Újrakezdése</button>

    <div class="input-area">
        <label for="guess">Tippeld meg a szennyezés forrását:</label>
        <input type="number" id="guess" min="1" max="15" placeholder="Medence száma (1-15)">
        <button onclick="checkGuess()">Tippelés</button>
        <p id="question-count">Feltett kérdések száma: 0</p>
    </div>

    <script>
        const numRows = 3;
        const numCols = 5;
        const numPools = numRows * numCols;
        let canvas;
        let ctx;
        let poolsData = [];
        let potentialSources = Array.from({ length: numPools }, (_, i) => i);
        let questionCount = 0;
        let checkedPools = new Array(numPools).fill(null);
        const poolRadius = 25; // Kicsit kisebb medencék
        const arrowLength = 35;
        let canvasWidth;
        let canvasHeight;

        function initCanvas() {
            canvas = document.getElementById('pools-canvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            canvas.addEventListener('click', handleCanvasClick);
        }

        function resizeCanvas() {
            canvasWidth = Math.min(canvas.offsetWidth, 650);
            const poolDiameterWithGap = (poolRadius * 2) + 30; // Nagyobb távolság a medencék között
            canvasHeight = (numRows * poolDiameterWithGap) + 30;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            drawPools();
        }

        function createPoolsData() {
            poolsData = [];
            const poolDiameterWithGap = (poolRadius * 2) + 30; // Nagyobb távolság a medencék között
            const startX = (canvasWidth - (numCols * poolDiameterWithGap - 30)) / 2 + poolRadius;
            const startY = 25 + poolRadius;

            for (let i = 0; i < numPools; i++) {
                const row = Math.floor(i / numCols);
                const col = i % numCols;
                const x = startX + col * poolDiameterWithGap;
                const y = startY + row * poolDiameterWithGap;
                poolsData.push({ x, y, number: i + 1, contaminated: false, clean: false });
            }
        }

        function drawPools() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // Először rajzoljuk meg a nyilakat, hogy a medencék alá kerüljenek
            poolsData.forEach((pool, index) => {
                const row = Math.floor(index / numCols);
                const col = index % numCols;

                // A nyilakat a medencék között rajzoljuk
                // Nyíl jobbra
                if (col < numCols - 1) {
                    const nextPool = poolsData[index + 1];
                    const distance = nextPool.x - pool.x;
                    const fromX = pool.x + poolRadius + 5;
                    const toX = nextPool.x - poolRadius - 5;
                    const midY = pool.y;
                    
                    // Ha van elég hely a nyílnak
                    if (toX > fromX + 15) {
                        drawArrow(fromX, midY, toX, midY);
                    }
                }

                // Nyíl lefelé
                if (row < numRows - 1) {
                    const nextPool = poolsData[index + numCols];
                    const distance = nextPool.y - pool.y;
                    const fromY = pool.y + poolRadius + 5;
                    const toY = nextPool.y - poolRadius - 5;
                    const midX = pool.x;
                    
                    // Ha van elég hely a nyílnak
                    if (toY > fromY + 15) {
                        drawArrow(midX, fromY, midX, toY);
                    }
                }
            });
            
            // Majd rajzoljuk meg a medencéket
            poolsData.forEach((pool, index) => {
                // Medence háttér
                ctx.beginPath();
                ctx.arc(pool.x, pool.y, poolRadius, 0, 2 * Math.PI);
                if (pool.contaminated) {
                    ctx.fillStyle = '#f44336'; // Piros a szennyezett medencéknek
                } else if (pool.clean) {
                    ctx.fillStyle = '#4caf50'; // Zöld a tiszta medencéknek
                } else {
                    ctx.fillStyle = '#add8e6'; // Világoskék az ismeretlen állapotú medencéknek
                }
                ctx.fill();
                
                // Medence szegélye
                ctx.lineWidth = 1.5;
                ctx.strokeStyle = '#1e3a8a';
                ctx.stroke();

                // Medence száma
                ctx.fillStyle = '#000';
                ctx.font = '15px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(pool.number, pool.x, pool.y);
            });
        }

        function drawArrow(fromX, fromY, toX, toY) {
            const headlen = 10; // Nyílhegy mérete
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            const length = Math.sqrt(dx * dx + dy * dy);
            
            // Nyíl kezdő és végpontjának beállítása
            // Ha a nyíl hossza elég nagy, akkor a nyíl teljes hosszát rajzoljuk
            const shortening = Math.min(5, length * 0.1);
            const actualToX = toX - shortening * Math.cos(angle);
            const actualToY = toY - shortening * Math.sin(angle);
            
            // Nyíl teste
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(actualToX, actualToY);
            ctx.strokeStyle = '#1e3a8a';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Nyílhegy
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headlen * Math.cos(angle - Math.PI / 6),
                toY - headlen * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                toX - headlen * Math.cos(angle + Math.PI / 6),
                toY - headlen * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fillStyle = '#1e3a8a';
            ctx.fill();
        }

        function isContaminatedHypothetically(sourceIndex, targetIndex) {
            const sourceRow = Math.floor(sourceIndex / numCols);
            const sourceCol = sourceIndex % numCols;
            const targetRow = Math.floor(targetIndex / numCols);
            const targetCol = targetIndex % numCols;
            return targetRow >= sourceRow && targetCol >= sourceCol;
        }

        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            poolsData.forEach((pool, index) => {
                const distance = Math.sqrt((x - pool.x) ** 2 + (y - pool.y) ** 2);
                if (distance < poolRadius) {
                    checkPollution(index);
                }
            });
        }

        function checkPollution(index) {
            if (checkedPools[index] !== null) {
                document.getElementById('message').textContent = `Erre a medencére már rákérdeztél.`;
                return;
            }

            let contaminatedCount = 0;
            let notContaminatedCount = 0;
            let contaminatedSources = [];
            let notContaminatedSources = [];

            potentialSources.forEach(source => {
                if (isContaminatedHypothetically(source, index)) {
                    contaminatedCount++;
                    contaminatedSources.push(source);
                } else {
                    notContaminatedCount++;
                    notContaminatedSources.push(source);
                }
            });

            let isActuallyContaminated;
            if (contaminatedCount > notContaminatedCount) {
                isActuallyContaminated = true;
                potentialSources = contaminatedSources;
            } else if (notContaminatedCount > contaminatedCount) {
                isActuallyContaminated = false;
                potentialSources = notContaminatedSources;
            } else {
                isActuallyContaminated = Math.random() < 0.5;
                potentialSources = isActuallyContaminated ? contaminatedSources : notContaminatedSources;
            }

            checkedPools[index] = isActuallyContaminated;
            questionCount++;
            document.getElementById('question-count').textContent = `Feltett kérdések száma: ${questionCount}`;

            poolsData[index].contaminated = isActuallyContaminated;
            poolsData[index].clean = !isActuallyContaminated;
            drawPools();

            const messageElement = document.getElementById('message');
            messageElement.textContent = `A(z) ${index + 1}. medence ${isActuallyContaminated ? 'szennyezett.' : 'tiszta.'}`;

            updatePotentialSourcesDisplay();
        }

        function checkGuess() {
            const guessInput = document.getElementById('guess');
            const messageElement = document.getElementById('message');
            const guessedSource = parseInt(guessInput.value) - 1;

            if (isNaN(guessedSource) || guessedSource < 0 || guessedSource >= numPools) {
                messageElement.textContent = "Kérlek, érvényes medence számot adj meg (1-15).";
                return;
            }

            if (potentialSources.length === 1 && potentialSources[0] === guessedSource) {
                messageElement.textContent = `Gratulálok! A(z) ${guessedSource + 1}. medence volt a szennyezés forrása.`;
                revealPollution(guessedSource);
            } else {
                let otherPotentialSource;
                const otherPotentialSources = potentialSources.filter(s => s !== guessedSource);
                if (otherPotentialSources.length > 0) {
                    const randomIndex = Math.floor(Math.random() * otherPotentialSources.length);
                    otherPotentialSource = otherPotentialSources[randomIndex] + 1;
                }
//                messageElement.textContent = `Sajnálom, nem a(z) ${guessedSource + 1}. medence volt a szennyezés forrása. A ${potentialSources.map(s => s + 1).join(', ')}.`;
                messageElement.textContent = `Sajnálom, a tipped (${guessedSource + 1}.) nem talált, a ${otherPotentialSource}. medence volt a forrás.`;
            }
        }

        function revealPollution(source) {
            for (let i = 0; i < numPools; i++) {
                if (isContaminatedHypothetically(source, i)) {
                    poolsData[i].contaminated = true;
                    poolsData[i].clean = false;
                } else {
                    poolsData[i].contaminated = false;
                    poolsData[i].clean = true;
                }
            }
            
            // Kiemeljük a forrást
            poolsData[source].contaminated = true;
            poolsData[source].clean = false;
            
            drawPools();
            
            // Speciális kijelölés a forrásnak
            ctx.beginPath();
            ctx.arc(poolsData[source].x, poolsData[source].y, poolRadius + 3, 0, 2 * Math.PI);
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#ff9800';
            ctx.stroke();
            
            // Második kijelölés, pulzáló hatást adhat később, ha animációt adnánk hozzá
            ctx.beginPath();
            ctx.arc(poolsData[source].x, poolsData[source].y, poolRadius + 6, 0, 2 * Math.PI);
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#ff9800';
            ctx.stroke();
        }

        function updatePotentialSourcesDisplay() {
            // console.log("Lehetséges források:", potentialSources.map(s => s + 1));
        }

        function resetGame() {
            // Alaphelyzetbe állítjuk a játékot
            potentialSources = Array.from({ length: numPools }, (_, i) => i);
            questionCount = 0;
            checkedPools = new Array(numPools).fill(null);
            document.getElementById('question-count').textContent = `Feltett kérdések száma: ${questionCount}`;
            document.getElementById('message').textContent = "";
            document.getElementById('guess').value = "";
            
            // Alaphelyzetbe állítjuk a medencéket
            poolsData.forEach(pool => {
                pool.contaminated = false;
                pool.clean = false;
            });
            
            drawPools();
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('load', () => {
            initCanvas();
            createPoolsData();
            drawPools();
        });
    </script>

</body>
</html>
